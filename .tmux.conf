set -g default-terminal 'xterm-256color'
set -as terminal-overrides ",gnome*:RGB"
set -g set-clipboard off
set -g mouse on
set -g xterm-keys on
set -g mode-keys vi
set -g history-limit 999999
set -s escape-time 0
set -g set-titles on
set -g allow-rename on
set -g renumber-windows on
set -g display-panes-time 2000
set -g display-time 4000
set -g monitor-activity on
set -g visual-activity on
set -g base-index 1
setw -g aggressive-resize on
setw -g automatic-rename off
setw -g clock-mode-style 24
setw -g pane-base-index 1
setw -g word-separators ' ,:;"=()[]<>$'
setw -ag word-separators "'"
setw -g wrap-search off
set -g history-file ~/.tmux_history
set -g focus-events on

set -g status-justify left
set -g status-interval 1
set -g status-left-length 200
set -g status-right-length 200
set -g status-keys vi
set -g status-position bottom
set -g status-left " "
set -g status-right " #[fg=green]#{session_name} | #[fg=green]$USER@#{host_short} #{online_status} | %a %d %h | %H:%M:%S "

# default statusbar colors
set -g status-bg black #base02
set -g status-fg green
set -g status-attr default
# default window title colors
setw -g window-status-fg brightblue #base0
setw -g window-status-bg black
setw -g window-status-attr dim
# active window title colors
setw -g window-status-current-fg black
setw -g window-status-current-bg green #orange
setw -g window-status-current-attr bright
# pane border
set -g pane-border-fg black #base02
set -g pane-active-border-fg brightgreen #base01
# message text
set -g message-bg black #base02
set -g message-fg brightred #orange
# pane number display
set -g display-panes-active-colour blue #blue
set -g display-panes-colour brightred #orange
# clock
setw -g clock-mode-colour green #green

####################################################
#################### PLUGINS #######################
###################################################
# List of plugins
set -g @shell_mode 'vi'
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-urlview'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-online-status'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'

set -g @resurrect-strategy-vim 'session'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-dir '~/.tmux-resurrect-data/'
set -g @resurrect-save-shell-history 'on'
set -g @continuum-save-interval '3600'
set -g @continuum-restore 'on'
set -g @continuum-boot 'on'
set -g @emulate-scroll-for-no-mouse-alternate-buffer 'on'

####################################################
################### KEYBINDS #######################
####################################################

# split panes
bind -n C-M-j split-window -h
bind -n C-M-k split-window -v

# switch panes
bind -n C-Left select-pane -L
bind -n C-Right select-pane -R
bind -n C-Up select-pane -U
bind -n C-Down select-pane -D

# windows
bind -n C-M-PageUp previous-window
bind -n C-M-PageDown next-window
bind -n C-M-y command-prompt -ip "(window name)" "rename-window \"%%%\""
bind -n C-S-PageUp swap-window -t -1
bind -n C-S-PageDown swap-window -t +1
bind -n C-Space resize-pane -Z
bind -n C-M-t new-window \; command-prompt -ip "(window name)" "rename-window \"%%%\""

# copy-mode
bind -n C-PageUp select-pane\; copy-mode -e \; \
	send -X halfpage-up \;
bind -n S-PageUp select-pane\; copy-mode -eu \; \
	send -X history-top \; \
	send -X start-of-line

bind -T copy-mode-vi Home send -X start-of-line
bind -T copy-mode-vi End send -X end-of-line
bind -T copy-mode-vi S-Right send -X next-space-end
bind -T copy-mode-vi S-Left send -X previous-word
bind -T copy-mode-vi S-Up send -X top-line
bind -T copy-mode-vi S-Down send -X bottom-line \; \
	send -X end-of-line
bind -T copy-mode-vi C-PageUp send -X halfpage-up
bind -T copy-mode-vi C-PageDown send -X halfpage-down
bind -T copy-mode-vi S-PageUp send -X history-top \; \
	send -X start-of-line
bind -T copy-mode-vi S-PageDown send -X history-bottom \; \
	send -X end-of-line

bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel \; \
	run "tmux save-buffer - | xclip -i -selection primary > /dev/null"
bind -T copy-mode-vi r send -X rectangle-toggle

bind -n C-M-v select-pane \; copy-mode
bind -n C-M-a select-pane \; copy-mode \; \
	send -X bottom-line \; \
	send -X end-of-line \; \
	send -X begin-selection \; \
	send -X top-line \; \
	send -X start-of-line

# middle click to paste from the clipboard
bind -n MouseDown2Pane select-pane \; \
	run "tmux set-buffer \"$(xclip -o -selection primary)\"; \
	tmux paste-buffer > /dev/null"
bind -T copy-mode-vi MouseDown2Pane select-pane \; \
	send -X copy-selection-and-cancel \; \
	run "tmux save-buffer - | xclip -i -selection primary > /dev/null" \; \
	run "tmux set-buffer \"$(xclip -o -selection primary)\"; \
	tmux paste-buffer > /dev/null"

# selection with mouse should copy to clipboard right away, in addition to the default action.
bind -T copy-mode-vi MouseDragEnd1Pane select-pane \; \
	send -X copy-pipe "xclip -in -selection primary" \; \
	run "tmux save-buffer - | xclip -i -selection primary > /dev/null" \; \
	send -X stop-selection 
bind -T copy-mode-vi MouseUp1Pane select-pane \; \
	send -X stop-selection
bind -T copy-mode-vi MouseDown1Pane select-pane \; \
	send -X stop-selection \; \
	send -X clear-selection

bind -n C-WheelUpPane copy-mode -e \; \
	send -X -N 1 scroll-up
bind -n S-WheelUpPane copy-mode -eu \; \
	send -X halfpage-up
bind -T copy-mode-vi C-WheelUpPane send -X clear-selection \; \
	send -X -N 1 scroll-up
bind -T copy-mode-vi S-WheelUpPane send -X clear-selection \; \
	send -X halfpage-up
bind -T copy-mode-vi C-WheelDownPane send -X clear-selection \; \
	send -X -N 1 scroll-down
bind -T copy-mode-vi S-WheelDownPane send -X clear-selection \; \
	send -X halfpage-down

# double LMB Select & Copy (Word)
bind-key -T root DoubleClick1Pane if -Ft{mouse_any_flag} '#{alternate_on}' \
	"send -M" "copy-mode -t{mouse}; send -X select-word; \
        send -X stop-selection; send -X copy-pipe \"xclip -in -selection primary\"; \
	run \"tmux save-buffer - | xclip -i -selection primary > /dev/null\""
bind -T copy-mode-vi DoubleClick1Pane select-pane \; \
	send -X select-word \; send -X stop-selection \; \
	send -X copy-pipe "xclip -in -selection primary" \; \
	run "tmux save-buffer - | xclip -i -selection primary > /dev/null"
# triple LMB Select & Copy (Line)
bind-key -T root TripleClick1Pane if-shell -Ft{mouse_any_flag} '#{alternate_on}' \
	"send -M" "copy-mode -t{mouse}; send -X select-line; \
        send -X stop-selection; send -X copy-pipe \"xclip -in -selection primary\"; \
	run \"tmux save-buffer - | xclip -i -selection primary > /dev/null\""
bind -T copy-mode-vi TripleClick1Pane select-pane \; \
	send -X select-line \; send -X stop-selection \; \
	send -X copy-pipe "xclip -in -selection primary" \; \
	run "tmux save-buffer - | xclip -i -selection primary > /dev/null"

# search
bind -n C-M-f select-pane \; copy-mode\; \
	command-prompt -ip "(search up)" "send -X search-backward-incremental \"%%%\""
	#command-prompt -i -I "#{pane_search_string}" -p "(search up)" "send -X search-backward-incremental \"%%%\""
bind -T copy-mode-vi C-M-f select-pane \; \
	command-prompt -ip "(search up)" "send -X search-backward-incremental \"%%%\""
bind -n C-M-g select-pane \; copy-mode\; \
	command-prompt -ip "(search down)" "send -X search-forward-incremental \"%%%\""
bind -T copy-mode-vi C-M-g select-pane \; \
	command-prompt -ip "(search down)" "send -X search-forward-incremental \"%%%\""
bind -n C-M-h select-pane\; choose-buffer

# misc
bind -n C-M-l select-pane \; \
	confirm-before -p "(clear history) (y/n)" "clear-history"
# save scrollback to prompted filename
bind -n C-M-s command-prompt -p '(save history)' -I '~/tmux.history' \
	'capture-pane -S - ; save-buffer %1 ; delete-buffer'


# initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
